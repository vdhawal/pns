<!DOCTYPE html>

<html>
    <head>
        <title>Admin</title>
        
        <!-- Material Design Theming -->
        <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.orange-indigo.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>
        
        <link rel="stylesheet" type="text/css" href="css/admin.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="js/admin.js"></script>
    </head>
    <body>
        <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">

            <!-- Header section containing title -->
            <header class="mdl-layout__header mdl-color-text--white mdl-color--light-blue-700">
                <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">
                    <div class="mdl-layout__header-row mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--8-col-desktop">
                        <h3>Admin</h3>
                    </div>
                </div>
            </header>

            <main class="mdl-layout__content mdl-color--grey-100">
                <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid">

                    <!-- Container for the Table of content -->
                    <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
                        <div class="mdl-card__supporting-text mdl-color-text--grey-600">
                            
                            <div>
                                <h4>Enter the message</h4>
                                <textarea class = "mdl-textfield" id="Message"></textarea>
                            </div>
                            
                            <div class = "button-container">
                                <button class="inline mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="sendNotificationToSelectedUsers()">Send Notification</button>
                                <p id = "send_status" class = "inline" style="word-break: break-all;"></p>
                            </div>

                            <div class = "button-container">
                                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="deleteAllEntriesFromDb()">Clear Entries From Database</button>
                            </div>
                            
                            <!-- div to display table of subscribers. -->
                            <div id="users">
                            </div>
                            
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <script>
            var xmlhttp, myObj, txt = "";
            xmlhttp = new XMLHttpRequest();
            xmlhttp.onload = function() {
                    myObj = JSON.parse(this.responseText);
                    txt += "<table class='mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp'><caption>Subscribers</caption><thead><tr><th class='mdl-data-table__cell--non-numeric'>Topic</th><th>Browser</th><th>OS</th><th>Service</th><th>Token ID</th></tr></thead><tbody>"
                    myObj.result.forEach(function(user){
                        txt += "<tr><td class='mdl-data-table__cell--non-numeric--selectable'>" + user.topic + "</td><td>" + user.browser + "</td><td>" + user.os + "</td><td>" + user.service + "</td><td class = 'uuid'>" + user.uuid + "</td></tr>";
                    });
                    txt += "</tbody></table>" 
                    document.getElementById("users").innerHTML = txt;
            }
            xmlhttp.open("GET", "/users", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.send();
        </script>
    </body>
</html>